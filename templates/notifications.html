{% extends "base.html" %}
{% block content %}
<div class="section-header">
  <h1 class="page-title">Notificaciones</h1>
  <button type="button" class="btn btn-secondary" id="btn-cargar">ðŸ”” Cargar Notificaciones</button>
</div>
<div class="card">
  <div id="notificaciones-area">
    <p class="empty-state" style="font-style: italic; color: var(--text-muted);">No hay notificaciones disponibles</p>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
(function() {
  const area = document.getElementById('notificaciones-area');
  const btnCargar = document.getElementById('btn-cargar');

  function escapeHtml(s) {
    const div = document.createElement('div');
    div.textContent = s || '';
    return div.innerHTML;
  }

  function renderNotificaciones(notifs) {
    if (!notifs || !notifs.length) {
      area.innerHTML = '<p class="empty-state" style="font-style: italic; color: var(--text-muted);">No hay notificaciones disponibles</p>';
      return;
    }
    area.innerHTML = '<ul class="notif-list">' + notifs.map(n => `
      <li>
        ${escapeHtml(n.mensaje || n.texto || JSON.stringify(n))}
        <br><small>${escapeHtml(n.created_at || '')}</small>
      </li>
    `).join('') + '</ul>';
  }

  btnCargar.addEventListener('click', function() {
    fetch('/api/notificaciones')
      .then(r => r.json())
      .then(renderNotificaciones)
      .catch(() => {
        area.innerHTML = '<p class="empty-state" style="font-style: italic;">Error al cargar notificaciones</p>';
      });
  });
})();
</script>
{% endblock %}
